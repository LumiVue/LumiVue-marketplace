<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LumiVue   Product Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    :root{
      /* LumiVue latte / espresso system */
      --lv-bg:#f4f1eb;
      --lv-surface:#ffffff;
      --lv-border:#e6d7c6;
      --lv-border-strong:#d9c6b3;
      --lv-text:#2c1e19;
      --lv-text-muted:#7a6a5c;
      --lv-pill:#e3ceb2;
      --lv-pill-border:#c9a07a;
      --lv-accent-soft:#fbf3e7;
      --lv-shadow-soft:0 24px 60px rgba(15,23,42,.08);
      --lv-radius-lg:14px;
      --lv-radius-md:10px;
    }

    html{scroll-behavior:smooth}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif;
      background:var(--lv-bg);
      color:var(--lv-text);
    }
    a{color:inherit;text-decoration:none}

    /* ??? TOP BAR ??????????????????????????????? */
    .lv-header{
      position:sticky;top:0;z-index:40;
      background:linear-gradient(180deg,#fbf8f2 0%, #f6f1ea 100%);
      border-bottom:1px solid rgba(0,0,0,.06);
      backdrop-filter:saturate(120%) blur(8px);
    }
    .lv-header-inner{
      max-width:1120px;margin:0 auto;
      padding:10px 18px;display:flex;align-items:center;gap:18px;
    }
    .lv-badge{
      width:28px;height:28px;border-radius:999px;
      background:#d3b79e;color:#2b2118;
      display:grid;place-items:center;font-weight:700;font-size:12px;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.28);
      flex:0 0 28px;
    }
    .lv-wordmark{letter-spacing:.38em;font-weight:700;font-size:13px;margin-left:6px}
    .lv-nav{margin-left:16px;display:flex;align-items:center;gap:18px;font-size:14px;color:var(--lv-text-muted)}
    .lv-nav a{padding:2px 0;border-bottom:1px solid transparent}
    .lv-nav a:hover{color:var(--lv-text);border-bottom-color:var(--lv-border)}
    .lv-nav a.active{color:var(--lv-text);font-weight:600;border-bottom-color:var(--lv-border)}
    .lv-actions{margin-left:auto;display:flex;align-items:center;gap:10px}
    .lv-pill-btn{
      background:var(--lv-pill);border:1px solid var(--lv-pill-border);color:var(--lv-text);
      border-radius:999px;padding:6px 12px;font-size:12px;letter-spacing:.06em;cursor:pointer;
    }
    .lv-pill-btn:active{transform:translateY(1px)}
    .lv-avatar{
      width:28px;height:28px;border-radius:999px;background:#d3b79e;color:#2b2118;
      display:grid;place-items:center;font-weight:700;font-size:12px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.28);
    }

    /* ??? MAIN LAYOUT ??????????????????????????????? */
    .lv-main{
      max-width:1120px;margin:24px auto 48px;
      padding:0 18px;
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,1fr);
      gap:24px;
      align-items:flex-start;
    }
    @media (max-width:960px){.lv-main{grid-template-columns:1fr}}

    .lv-card{
      background:var(--lv-surface);
      border:1px solid var(--lv-border);
      border-radius:var(--lv-radius-lg);
      box-shadow:var(--lv-shadow-soft);
      padding:20px 24px;
    }
    .lv-card + .lv-card{margin-top:16px}
    .lv-card-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
    }
    .lv-card-title{font-size:18px;font-weight:700}
    .lv-card-subtitle{font-size:13px;color:var(--lv-text-muted);margin-top:4px}
    .lv-card-body{display:flex;flex-direction:column;gap:1rem}

    /* Product image */
    .lv-product-hero{
      width:100%;
      height:400px;
      border-radius:var(--lv-radius-lg);
      background:#e5e1d8;
      object-fit:cover;
      margin-bottom:16px;
    }

    .lv-status-badge{
      display:inline-block;
      background:var(--lv-pill);
      border:1px solid var(--lv-pill-border);
      color:var(--lv-text);
      border-radius:999px;
      padding:6px 12px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.1em;
      font-weight:600;
    }
    .lv-status-badge.active{
      background:#c8e6c9;
      border-color:#81c784;
      color:#2e7d32;
    }

    .lv-product-title{
      font-size:28px;
      font-weight:700;
      margin:12px 0 8px;
    }
    .lv-product-subtitle{
      font-size:16px;
      color:var(--lv-text-muted);
      margin-bottom:16px;
    }
    .lv-product-price{
      font-size:32px;
      font-weight:700;
      margin-bottom:8px;
    }
    .lv-product-meta{
      font-size:14px;
      color:var(--lv-text-muted);
      margin-bottom:20px;
    }
    .lv-product-description{
      font-size:15px;
      line-height:1.6;
      color:var(--lv-text);
    }

    .lv-info-row{
      display:flex;
      justify-content:space-between;
      padding:12px 0;
      border-bottom:1px solid var(--lv-border);
      font-size:14px;
    }
    .lv-info-row:last-child{border-bottom:none}
    .lv-info-label{color:var(--lv-text-muted);font-weight:500}
    .lv-info-value{font-weight:600}

    .lv-error-state{
      text-align:center;
      padding:60px 20px;
    }
    .lv-error-icon{font-size:48px;margin-bottom:16px;opacity:0.3}
    .lv-error-title{font-size:20px;font-weight:600;margin-bottom:8px}
    .lv-error-text{font-size:14px;color:var(--lv-text-muted);margin-bottom:20px}
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="lv-header">
    <div class="lv-header-inner">
      <div class="lv-badge">LV</div>
      <div class="lv-wordmark">L U M I V U E</div>

      <nav class="lv-nav">
        <a href="dashboard.html">Dashboard</a>
        <a href="listings.html">My products</a>
        <a href="create-listing.html">Create listing</a>
        <a href="orders.html">Orders</a>
      </nav>

      <div class="lv-actions">
        <button class="lv-pill-btn" onclick="window.location.href='listings.html'">? Back to products</button>
        <button class="lv-pill-btn" id="editBtn" style="display:none;">Edit product</button>
        <div class="lv-avatar">M</div>
      </div>
    </div>
  </header>

  <main class="lv-main" id="mainContent" style="display:none;">
    <!-- LEFT COLUMN   Product Details -->
    <section>
      <div class="lv-card">
        <img id="productImage" class="lv-product-hero" alt="Product image" />
        <span id="productStatus" class="lv-status-badge">Draft</span>
        <h1 class="lv-product-title" id="productTitle">Loading...</h1>
        <p class="lv-product-subtitle" id="productSubtitle"></p>
        <div class="lv-product-price" id="productPrice">$0.00</div>
        <div class="lv-product-meta" id="productMeta"></div>
        <div class="lv-product-description" id="productDescription"></div>
      </div>
    </section>

    <!-- RIGHT COLUMN   Product Info -->
    <aside>
      <div class="lv-card">
        <div class="lv-card-header">
          <div class="lv-card-title">Product Information</div>
        </div>
        <div class="lv-card-body">
          <div class="lv-info-row">
            <span class="lv-info-label">Vendor</span>
            <span class="lv-info-value" id="infoVendor"> </span>
          </div>
          <div class="lv-info-row">
            <span class="lv-info-label">Type</span>
            <span class="lv-info-value" id="infoType"> </span>
          </div>
          <div class="lv-info-row">
            <span class="lv-info-label">Collections</span>
            <span class="lv-info-value" id="infoCollections"> </span>
          </div>
          <div class="lv-info-row">
            <span class="lv-info-label">Currency</span>
            <span class="lv-info-value" id="infoCurrency"> </span>
          </div>
        </div>
      </div>

      <div class="lv-card" id="pricingCard" style="display:none;">
        <div class="lv-card-header">
          <div class="lv-card-title">Pricing Details</div>
        </div>
        <div class="lv-card-body">
          <div class="lv-info-row">
            <span class="lv-info-label">Price</span>
            <span class="lv-info-value" id="infoPrice"> </span>
          </div>
          <div class="lv-info-row" id="compareAtRow" style="display:none;">
            <span class="lv-info-label">Compare-at price</span>
            <span class="lv-info-value" id="infoCompareAt"> </span>
          </div>
          <div class="lv-info-row" id="costRow" style="display:none;">
            <span class="lv-info-label">Cost per item</span>
            <span class="lv-info-value" id="infoCost"> </span>
          </div>
        </div>
      </div>

      <div class="lv-card" id="ingredientsCard" style="display:none;">
        <div class="lv-card-header">
          <div class="lv-card-title">Ingredients (INCI)</div>
        </div>
        <div class="lv-card-body">
          <div id="inciIngredientsList" style="font-size:13px;line-height:1.6;color:var(--lv-text);"> </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Error State -->
  <div id="errorState" class="lv-error-state" style="display:none;">
    <div class="lv-error-icon">??</div>
    <div class="lv-error-title">Product not found</div>
    <div class="lv-error-text">This product may have been deleted or you may not have access to it.</div>
    <button class="lv-pill-btn" onclick="window.location.href='listings.html'">Back to products</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAMmOyBqyPr5KoIzqnItE4sH1lb83iQAo8",
      authDomain: "lumivue-c8fdf.firebaseapp.com",
      projectId: "lumivue-c8fdf",
      storageBucket: "lumivue-c8fdf.firebasestorage.app",
      messagingSenderId: "120420036736",
      appId: "1:120420036736:web:0fbbc98b02ea54840d3665"
    };

    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get product ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    async function loadProduct() {
      if (!productId) {
        document.getElementById("errorState").style.display = "block";
        return;
      }

      try {
        const docRef = doc(db, "listings", productId);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
          document.getElementById("errorState").style.display = "block";
          return;
        }

        const data = docSnap.data();
        document.getElementById("mainContent").style.display = "grid";
        document.getElementById("editBtn").style.display = "block";

        // Image
        if (data.imageUrl) {
          document.getElementById("productImage").src = data.imageUrl;
          document.getElementById("productImage").style.display = "block";
        } else {
          document.getElementById("productImage").style.display = "none";
        }

        // Status
        const statusEl = document.getElementById("productStatus");
        const isActive = data.status === "active";
        statusEl.textContent = isActive ? "Active" : "Draft";
        if (isActive) statusEl.classList.add("active");

        // Basic info
        document.getElementById("productTitle").textContent = data.title || "Untitled";
        document.getElementById("productSubtitle").textContent = data.subtitle || "";
        
        // Price
        const price = data.priceNumber || parseFloat(data.price) || 0;
        const currency = data.currency === "USD" ? "$" : (data.currency || "$");
        document.getElementById("productPrice").textContent = `${currency}${price.toFixed(2)}`;
        
        // Meta
        document.getElementById("productMeta").textContent = 
          `${data.vendor || "Unknown vendor"}   ${data.type || "Product"}`;
        
        // Description
        const descEl = document.getElementById("productDescription");
        if (data.description) {
          descEl.textContent = data.description;
          descEl.style.display = "block";
        } else {
          descEl.style.display = "none";
        }

        // Right column info
        document.getElementById("infoVendor").textContent = data.vendor || " ";
        document.getElementById("infoType").textContent = data.type || " ";
        document.getElementById("infoCollections").textContent = data.collections || " ";
        document.getElementById("infoCurrency").textContent = data.currency || "USD";

        // Pricing details
        document.getElementById("pricingCard").style.display = "block";
        document.getElementById("infoPrice").textContent = `${currency}${price.toFixed(2)}`;
        
        if (data.compareAt) {
          document.getElementById("compareAtRow").style.display = "flex";
          document.getElementById("infoCompareAt").textContent = `${currency}${parseFloat(data.compareAt).toFixed(2)}`;
        }
        
        if (data.costPerItem) {
          document.getElementById("costRow").style.display = "flex";
          document.getElementById("infoCost").textContent = `${currency}${parseFloat(data.costPerItem).toFixed(2)}`;
        }

        // INCI Ingredients
        if (data.inciIngredients) {
          document.getElementById("ingredientsCard").style.display = "block";
          document.getElementById("inciIngredientsList").textContent = data.inciIngredients;
        }

      } catch (err) {
        console.error("Error loading product:", err);
        document.getElementById("errorState").style.display = "block";
        document.getElementById("errorState").querySelector(".lv-error-text").textContent = err.message;
      }
    }

    // Load product when page loads
    loadProduct();

    // Edit button (future functionality)
    document.getElementById("editBtn")?.addEventListener("click", () => {
      alert("Edit functionality coming soon! For now, you can create a new product.");
      // Future: window.location.href = `edit-listing.html?id=${productId}`;
    });
  </script>
</body>
</html>
