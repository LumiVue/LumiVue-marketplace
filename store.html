<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LumiVue Storefront</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    :root {
      --lv-bg: #f4f1eb;
      --lv-surface: #ffffff;
      --lv-border: #ddd3c6;
      --lv-border-strong: #ccc0b1;
      --lv-text: #2c1e19;
      --lv-text-muted: #7a6a5c;
      --lv-accent: #c98a5a;
      --lv-accent-soft: #fbede1;
      --lv-radius-lg: 18px;
      --lv-shadow-soft: 0 30px 80px rgba(15, 23, 42, 0.22); /* richer soft shadow */
      --lv-hero-latte: #f1ddc2;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, rgba(201,138,90,0.10), var(--lv-bg));
      color: var(--lv-text);
    }

    .page {
      max-width: 1120px;
      margin: 0 auto 64px;
      padding: 0 24px;
    }

    /***** TOP NAV – THIS IS THE VENDOR'S WEBSITE HEADER *****/
    .site-nav {
      height: 72px; /* slightly thicker */
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid rgba(0,0,0,0.03);
      background: #f7f3eb;
      position: sticky;
      top: 0;
      z-index: 40;
      box-shadow: 0 10px 30px rgba(15,23,42,0.08); /* subtle nav shadow */
    }

    .site-nav-inner {
      width: 100%;
      max-width: 1120px;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .nav-logo-circle {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: #d8b58b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: #2c1e19;
      text-transform: uppercase;
    }

    .nav-brand-text {
      font-size: 13px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--lv-text);
    }

    .nav-tabs {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1;
    }

    .nav-tab-link {
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      background: #efe1cf;
      font-size: 11px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #3b2719;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      white-space: nowrap;
      text-decoration: none;
    }

    .nav-tab-link:hover {
      background: #e5d3be;
    }

    .nav-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
      white-space: nowrap;
      min-width: 80px;
    }

    .nav-avatar {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: #d8b58b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: #2c1e19;
      text-transform: uppercase;
    }

    @media (max-width: 900px) {
      .nav-tabs {
        gap: 6px;
      }
      .nav-tab-link {
        padding: 4px 10px;
        font-size: 10px;
      }
    }

    @media (max-width: 720px) {
      .site-nav-inner {
        padding: 0 12px;
        gap: 8px;
      }
      .nav-tabs {
        display: none;
      }
    }

    /***** HERO VIDEO – NO TEXT OVERLAY *****/
    .store-hero {
      margin-top: 28px;
      border-radius: 32px;
      overflow: hidden;
      position: relative;
      box-shadow: var(--lv-shadow-soft); /* subtle but strong hero shadow */
      background: var(--lv-hero-latte);
      height: 360px; /* cinematic strip */
      border: 1px solid var(--lv-border-strong); /* NEW: card frame */
    }

    .store-hero-media {
      position: absolute;
      inset: 0;
      background: var(--lv-hero-latte);
      overflow: hidden;
    }

    .store-hero-video,
    .store-hero-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /***** FEATURED PRODUCT GRID – ONLY THING BELOW HERO *****/
    .featured-section {
      margin-top: 56px; /* more spacing under hero */
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr)); /* FIVE CARDS PER ROW */
      gap: 18px;
    }

    .product-card {
      border-radius: 18px;
      border: 1px solid var(--lv-border);
      background: #fffdfa;
      box-shadow: 0 22px 55px rgba(15,23,42,0.18); /* slightly richer card shadow */
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease;
    }

    .product-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 28px 65px rgba(15,23,42,0.22);
      border-color: rgba(201,138,90,0.7);
    }

    .product-card.placeholder {
      cursor: default;
    }

    .product-card.placeholder:hover {
      transform: none;
      box-shadow: 0 22px 55px rgba(15,23,42,0.18);
      border-color: var(--lv-border);
    }

    .product-img-wrap {
      position: relative;
      padding-top: 100%; /* square */
      background: radial-gradient(circle at top left, #f5e1c7, #f7eee3);
      overflow: hidden;
    }

    .product-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-placeholder-label {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(60, 38, 22, 0.65);
      text-align: center;
      padding: 0 12px;
    }

    .product-body {
      padding: 10px 12px 11px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .product-name {
      font-size: 12px;
      font-weight: 600;
      color: var(--lv-text);
    }

    .product-sub {
      font-size: 11px;
      color: var(--lv-text-muted);
    }

    .product-footer {
      margin-top: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
    }

    .product-price {
      font-weight: 600;
      color: var(--lv-text);
    }

    .product-chip-row {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      font-size: 9px;
      color: var(--lv-text-muted);
    }

    .product-chip {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--lv-border-strong);
      background: #fff;
    }

    .status-message {
      font-size: 12px;
      color: var(--lv-text-muted);
      margin-top: 16px;
    }

    @media (max-width: 900px) {
      .product-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (max-width: 720px) {
      .product-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>

<body>
  <!-- TOP NAV: LUMIVUE + STORE TABS (BUYER FACING ONLY) -->
  <nav class="site-nav">
    <div class="site-nav-inner">
      <div class="nav-left">
        <div class="nav-logo-circle">LV</div>
        <div class="nav-brand-text">LUMIVUE</div>
      </div>

      <div class="nav-tabs">
        <a href="#" class="nav-tab-link" id="navCategoriesLink">Categories</a>
        <a href="#" class="nav-tab-link" id="navBrandStoryLink">Brand Story</a>
        <a href="#" class="nav-tab-link" id="navPoliciesLink">Policies</a>
        <a href="#" class="nav-tab-link" id="navIngredientsLink">Ingredient Glossary</a>
        <a href="#" class="nav-tab-link" id="navReviewsLink">Reviews</a>
        <a href="#" class="nav-tab-link" id="navFaqLink">FAQ</a>
      </div>

      <div class="nav-right">
        <!-- Vendor logo (initials) shown here -->
        <div class="nav-avatar" id="navAvatar">LV</div>
      </div>
    </div>
  </nav>

  <div class="page">
    <!-- HERO VIDEO ONLY -->
    <section class="store-hero" id="videoSection">
      <div class="store-hero-media">
        <video
          id="storeBannerVideo"
          class="store-hero-video"
          muted
          loop
          playsinline
          autoplay
          style="display:none;"
        ></video>
        <img id="storeBannerImg" class="store-hero-img" alt="" style="display:none;" />
      </div>
    </section>

    <!-- FEATURED PRODUCT CARDS ONLY -->
    <section class="featured-section">
      <div class="product-grid" id="productGrid"></div>
      <div class="status-message" id="productsStatus"></div>
    </section>
  </div>

  <!-- FIREBASE CONFIG (unchanged) -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAMmOyBqyPr5KoIzqnItE4sH1lb83iQAo8",
      authDomain: "lumivue-c8fdf.firebaseapp.com",
      projectId: "lumivue-c8fdf",
      storageBucket: "lumivue-c8fdf.firebasestorage.app",
      messagingSenderId: "120420036736",
      appId: "1:120420036736:web:0fbbc98b02ea54840d3665"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
  </script>

  <!-- STORE LOGIC -->
  <script>
    const PLACEHOLDER_MIN = 20; // show at least 20 card slots (5 x 4)

    const bannerImgEl = document.getElementById("storeBannerImg");
    const bannerVideoEl = document.getElementById("storeBannerVideo");
    const productGridEl = document.getElementById("productGrid");
    const productsStatusEl = document.getElementById("productsStatus");
    const navAvatar = document.getElementById("navAvatar");

    const navCategoriesLink = document.getElementById("navCategoriesLink");
    const navBrandStoryLink = document.getElementById("navBrandStoryLink");
    const navPoliciesLink = document.getElementById("navPoliciesLink");
    const navIngredientsLink = document.getElementById("navIngredientsLink");
    const navReviewsLink = document.getElementById("navReviewsLink");
    const navFaqLink = document.getElementById("navFaqLink");

    // ---------- HELPERS ----------
    function getStoreUidFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("uid") || params.get("creator") || params.get("store");
    }

    function setAvatarInitials(storeName, user) {
      let initials = "LV";
      if (storeName) {
        const parts = storeName.trim().split(/\s+/);
        if (parts.length === 1) {
          initials = parts[0].slice(0, 2).toUpperCase();
        } else {
          initials =
            (parts[0][0] || "L").toUpperCase() +
            (parts[1][0] || "V").toUpperCase();
        }
      } else if (user && user.email) {
        initials = (user.email[0] || "L").toUpperCase();
      }
      navAvatar.textContent = initials;
    }

    function buildPlaceholderCard() {
      const card = document.createElement("article");
      card.className = "product-card placeholder";

      const imgWrap = document.createElement("div");
      imgWrap.className = "product-img-wrap";

      const label = document.createElement("div");
      label.className = "product-placeholder-label";
      label.textContent = "Your product here. Add it in create-listing.html.";

      imgWrap.appendChild(label);

      const body = document.createElement("div");
      body.className = "product-body";

      const nameEl = document.createElement("div");
      nameEl.className = "product-name";
      nameEl.textContent = "Add your product in create-listing.html";

      const subEl = document.createElement("div");
      subEl.className = "product-sub";
      subEl.textContent = "This placeholder will be replaced when you upload.";

      const footer = document.createElement("div");
      footer.className = "product-footer";

      const priceEl = document.createElement("div");
      priceEl.className = "product-price";
      priceEl.textContent = "$0.00";

      const chipRow = document.createElement("div");
      chipRow.className = "product-chip-row";

      const chip = document.createElement("span");
      chip.className = "product-chip";
      chip.textContent = "Preview";

      chipRow.appendChild(chip);
      footer.appendChild(priceEl);
      footer.appendChild(chipRow);

      body.appendChild(nameEl);
      body.appendChild(subEl);
      body.appendChild(footer);

      card.appendChild(imgWrap);
      card.appendChild(body);

      return card;
    }

    function renderPlaceholders(count) {
      for (let i = 0; i < count; i++) {
        productGridEl.appendChild(buildPlaceholderCard());
      }
    }

    function wireTopLinks(uid) {
      // All top nav buttons go to a separate info page.
      const base = "store-info.html?uid=" + encodeURIComponent(uid);

      if (navCategoriesLink) navCategoriesLink.href = base + "#categories";
      if (navBrandStoryLink) navBrandStoryLink.href = base + "#brand-story";
      if (navPoliciesLink) navPoliciesLink.href = base + "#policies";
      if (navIngredientsLink) navIngredientsLink.href = base + "#ingredients";
      if (navReviewsLink) navReviewsLink.href = base + "#reviews";
      if (navFaqLink) navFaqLink.href = base + "#faq";
    }

    // ---------- LOAD PROFILE (FOR HERO + AVATAR) ----------
    async function loadStoreProfile(uid, currentUser) {
      try {
        const profileRef = db
          .collection("stores")
          .doc(uid)
          .collection("profile")
          .doc("main");
        const profileSnap = await profileRef.get();

        let profileData = profileSnap.exists ? profileSnap.data() : null;

        let creatorData = null;
        try {
          const creatorSnap = await db.collection("creators").doc(uid).get();
          if (creatorSnap.exists) creatorData = creatorSnap.data();
        } catch (e) {
          console.warn("Creator doc load failed (ok):", e);
        }

        const data = Object.assign({}, creatorData || {}, profileData || {});

        const storeName = data.storeName || data.brandName || null;
        setAvatarInitials(storeName, currentUser);

        // Hero media
        const videoUrl = data.storeVideoUrl;
        const bannerUrl =
          data.bannerImageUrl ||
          data.storeLogoUrl ||
          data.bannerUrl ||
          data.logoUrl;

        if (videoUrl && bannerVideoEl) {
          bannerVideoEl.src = videoUrl;
          bannerVideoEl.style.display = "block";
          if (bannerImgEl) bannerImgEl.style.display = "none";
          bannerVideoEl.play().catch(() => {});
        } else if (bannerUrl && bannerImgEl) {
          bannerImgEl.src = bannerUrl;
          bannerImgEl.style.display = "block";
          if (bannerVideoEl) bannerVideoEl.style.display = "none";
        } else {
          if (bannerVideoEl) bannerVideoEl.style.display = "none";
          if (bannerImgEl) bannerImgEl.style.display = "none";
        }
      } catch (err) {
        console.error("Profile error:", err);
      }
    }

    // ---------- LOAD PRODUCTS (FOR FEATURED GRID) ----------
    async function loadStoreProducts(uid) {
      try {
        const ref = db.collection("listings").where("ownerId", "==", uid);
        const snap = await ref.get();

        productGridEl.innerHTML = "";
        productsStatusEl.textContent = "";

        if (snap.empty) {
          // Show 20 placeholder cards so vendors see layout
          renderPlaceholders(PLACEHOLDER_MIN);
          productsStatusEl.textContent =
            "No products have been added yet. Use create-listing.html to add your first product.";
          return;
        }

        let count = 0;

        snap.forEach((doc) => {
          const data = doc.data();
          count++;

          const card = document.createElement("article");
          card.className = "product-card";

          const imgWrap = document.createElement("div");
          imgWrap.className = "product-img-wrap";

          if (data.primaryImage) {
            const img = document.createElement("img");
            img.className = "product-img";
            img.src = data.primaryImage;
            img.alt = data.title || "Product";
            imgWrap.appendChild(img);
          } else {
            const label = document.createElement("div");
            label.className = "product-placeholder-label";
            label.textContent = "Add photo in create-listing.html.";
            imgWrap.appendChild(label);
          }

          const body = document.createElement("div");
          body.className = "product-body";

          const nameEl = document.createElement("div");
          nameEl.className = "product-name";
          nameEl.textContent = data.title || "Untitled listing";

          const subEl = document.createElement("div");
          subEl.className = "product-sub";
          subEl.textContent = data.subtitle || data.category || "";

          const footer = document.createElement("div");
          footer.className = "product-footer";

          const priceEl = document.createElement("div");
          priceEl.className = "product-price";
          if (typeof data.price === "number") {
            priceEl.textContent = "$" + data.price.toFixed(2);
          } else if (data.price) {
            priceEl.textContent = "$" + data.price;
          } else {
            priceEl.textContent = "";
          }

          const chipRow = document.createElement("div");
          chipRow.className = "product-chip-row";

          const status = (data.status || "").toLowerCase();
          if (status) {
            const chip = document.createElement("span");
            chip.className = "product-chip";
            chip.textContent = status === "active" ? "Active" : status;
            chipRow.appendChild(chip);
          }

          if (data.valueVegan) {
            const chip = document.createElement("span");
            chip.className = "product-chip";
            chip.textContent = "Vegan";
            chipRow.appendChild(chip);
          }

          if (data.valueCrueltyFree) {
            const chip = document.createElement("span");
            chip.className = "product-chip";
            chip.textContent = "Cruelty-free";
            chipRow.appendChild(chip);
          }

          footer.appendChild(priceEl);
          footer.appendChild(chipRow);

          body.appendChild(nameEl);
          if (subEl.textContent) body.appendChild(subEl);
          body.appendChild(footer);

          card.appendChild(imgWrap);
          card.appendChild(body);

          card.addEventListener("click", () => {
            window.location.href =
              "product.html?id=" + encodeURIComponent(doc.id);
          });

          productGridEl.appendChild(card);
        });

        // If fewer than 20 products, pad with placeholders so grid shows 20 slots
        if (count < PLACEHOLDER_MIN) {
          renderPlaceholders(PLACEHOLDER_MIN - count);
        }
      } catch (err) {
        console.error("Product error:", err);
        productsStatusEl.textContent = "Could not load products.";
      }
    }

    // ---------- BOOTSTRAP ----------
    function bootstrapStore() {
      const urlUid = getStoreUidFromUrl();

      if (urlUid) {
        wireTopLinks(urlUid);
        loadStoreProfile(urlUid, null);
        loadStoreProducts(urlUid);
      } else {
        auth.onAuthStateChanged((user) => {
          if (!user) {
            productGridEl.innerHTML = "";
            renderPlaceholders(PLACEHOLDER_MIN);
            productsStatusEl.textContent =
              "Store not specified in URL. Sign in and visit your store link.";
            return;
          }
          const uid = user.uid;
          wireTopLinks(uid);
          loadStoreProfile(uid, user);
          loadStoreProducts(uid);
        });
      }
    }

    bootstrapStore();
  </script>
</body>
</html>
