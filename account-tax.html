<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LumiVue – Tax forms & marketplace agreements</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    :root {
      /* LumiVue latte / espresso system same as create-listing */
      --lv-bg: #f4f1eb;
      --lv-surface: #ffffff;
      --lv-border: #e6d7c6;
      --lv-border-strong: #d9c6b3;
      --lv-text: #2c1e19;          /* espresso */
      --lv-text-muted: #7a6a5c;
      --lv-pill: #e3ceb2;          /* beige pill */
      --lv-pill-border: #c9a07a;   /* caramel outline */
      --lv-accent-soft: #fbf3e7;
      --lv-shadow-soft: 0 24px 60px rgba(15,23,42,.08);
      --lv-radius-lg: 14px;
      --lv-radius-md: 10px;

      --lv-danger: #c15b4b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: var(--lv-bg);
      color: var(--lv-text);
    }

    /* Remove all hover pop-ups, transforms, and transitions */
    *:hover,
    *:focus,
    *:active {
      transition: none !important;
      transform: none !important;
      box-shadow: none !important;
      filter: none !important;
    }

    .page-shell {
      max-width: 100%;              /* full width */
      margin: 0 auto;
      padding: 18px 24px 40px;
    }

    .auth-page {
      max-width: 100%;
      margin: 0 auto;
    }

    /* TOP BAR – same LV header + pills as other pages */

    .site-header {
      padding-bottom: 8px;
      margin-bottom: 18px;
    }

    .site-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .brand-stack-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lv-badge {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: #d0b596;
      border: 1px solid #b89a77;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--lv-text);
    }

    .brand-wordmark {
      font-size: 13px;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: var(--lv-text);
    }

    .site-header-nav {
      display: flex;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
      margin-left: auto;
    }

    .nav-pill-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-pill {
      border-radius: 999px;
      border: 1px solid var(--lv-border-strong);
      padding: 6px 16px;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      text-decoration: none;
      background: #e6d8c7;
      color: var(--lv-text);
      cursor: pointer;
    }

    .nav-pill:hover {
      background: #e6d8c7; /* no hover pop-up */
    }

    /* MAIN CARD */

    .tax-card {
      background: var(--lv-surface);
      border-radius: 22px;
      padding: 22px 22px 20px;
      border: 1px solid var(--lv-border);
      box-shadow: var(--lv-shadow-soft);
      position: relative;
      max-width: 1440px;            /* wider card */
      margin: 0 auto;               /* centered */
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 18px;
      color: var(--lv-text-muted);
      cursor: pointer;
      text-decoration: none;
    }

    .back-link span {
      font-size: 16px;
    }

    .tax-header-block h1 {
      margin: 0 0 6px;
      font-size: 22px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--lv-text);
    }

    .tax-header-block p.lead {
      margin: 0 0 20px;
      font-size: 13px;
      color: var(--lv-text-muted);
      max-width: 540px;
      line-height: 1.6;
    }

    /* FORM */

    form#taxForm {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px 18px;
    }

    .full-row {
      grid-column: 1 / -1;
    }

    label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--lv-text-muted);
      margin-bottom: 4px;
      display: block;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--lv-border-strong);
      background: #fdf6eb;
      font-size: 13px;
      color: var(--lv-text);
      outline: none;
      transition: border-color 120ms ease, background 120ms ease;
    }

    textarea {
      border-radius: 18px;
      min-height: 90px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: #b2a391;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: #c6a574;
      background: #fffaf2;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--lv-text-muted);
    }

    .checkbox-row input[type="checkbox"] {
      width: 14px;
      height: 14px;
      border-radius: 4px;
    }

    /* FOOTER / BUTTONS */

    .actions-row {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 10px;
    }

    .hint {
      font-size: 11px;
      color: var(--lv-text-muted);
      max-width: 320px;
      line-height: 1.5;
    }

    .btn-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-primary {
      appearance: none;
      border-radius: 999px;
      padding: 8px 20px;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      border: 1px solid var(--lv-border-strong);
      cursor: pointer;
      background: #e6d8c7;
      color: var(--lv-text);
      box-shadow: none; /* no pop-up */
    }

    .btn-primary:hover {
      background: #e6d8c7; /* no hover pop-up */
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .status-pill {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid var(--lv-border-strong);
      background: var(--lv-accent-soft);
      color: var(--lv-text);
      min-width: 150px;
      text-align: center;
    }

    .status-pill.error {
      background: var(--lv-danger-soft);
      border-color: var(--lv-danger);
      color: #7c1f1f;
    }

    .status-pill.ok {
      background: var(--lv-accent-soft);
      border-color: var(--lv-accent);
      color: #3f3a2a;
    }

    /* LOADING OVERLAY */

    .loading-overlay {
      position: absolute;
      inset: 0;
      border-radius: 22px;
      background: rgba(244, 241, 235, 0.72);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: var(--lv-text-muted);
      backdrop-filter: blur(4px);
      pointer-events: none;
    }

    .loading-overlay.hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .page-shell {
        padding: 14px 16px 30px;
      }

      form#taxForm {
        grid-template-columns: minmax(0, 1fr);
      }

      .actions-row {
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="page-shell auth-page">
    <!-- TOP BAR -->
    <header class="site-header">
      <div class="site-header-inner">
        <div class="brand-stack-left">
          <div class="lv-badge">LV</div>
          <div class="brand-wordmark">LUMIVUE</div>
        </div>

        <div class="site-header-nav">
          <div class="nav-pill-group">
            <a href="marketplace.html" class="nav-pill">Marketplace</a>
            <a href="dashboard.html" class="nav-pill">Dashboard</a>
            <a href="listings.html" class="nav-pill">Listings</a>
            <a href="logout.html" class="nav-pill">Log out</a>
          </div>
        </div>
      </div>
    </header>

    <!-- TAX CARD -->
    <section class="tax-card">
      <div class="loading-overlay hidden" id="loadingOverlay">
        Loading tax details…
      </div>

      <a href="account.html" class="back-link">
        <span>←</span> Back to vendor account
      </a>

      <div class="tax-header-block">
        <h1>Tax forms &amp; marketplace agreements</h1>
        <p class="lead">
          Vendors will provide the tax information required for their region and agree to the LumiVue
          marketplace terms.
        </p>
      </div>

      <form id="taxForm">
        <div>
          <label for="taxType">Tax entity type</label>
          <select id="taxType" name="taxType">
            <option value="">Select type</option>
            <option>Individual / sole proprietor</option>
            <option>Single-member LLC</option>
            <option>LLC – Partnership</option>
            <option>Corporation</option>
          </select>
        </div>

        <div>
          <label for="tin">Tax ID</label>
          <input id="tin" name="tin" type="text" placeholder="Enter SSN / EIN / tax ID" />
        </div>

        <div class="full-row">
          <label for="country">Tax country / region</label>
          <select id="country" name="country">
            <option value="">Select country or region</option>
            <option>United States</option>
            <option>Canada</option>
            <option>United Kingdom</option>
            <option>Australia</option>
          </select>
        </div>

        <div class="full-row">
          <label for="formType">Form type</label>
          <select id="formType" name="formType">
            <option value="">Select form type</option>
            <option>W-9</option>
            <option>W-8BEN</option>
            <option>W-8BEN-E</option>
          </select>
        </div>

        <div class="full-row">
          <label for="agreement">Marketplace agreement notes</label>
          <textarea
            id="agreement"
            name="agreement"
            placeholder="Vendor can add any agreement notes or reference here."
          ></textarea>
        </div>

        <div class="full-row">
          <label class="checkbox-row">
            <input type="checkbox" id="taxConfirm" name="taxConfirm" />
            I confirm the information is accurate and I agree to the LumiVue marketplace terms.
          </label>
        </div>

        <div class="actions-row">
          <p class="hint">
            This information is stored securely for compliance and will be used when generating tax documents.
          </p>
          <div class="btn-row">
            <div id="saveStatus" class="status-pill">Not signed in</div>
            <button type="submit" id="saveButton" class="btn-primary">
              Save tax details
            </button>
          </div>
        </div>
      </form>
    </section>
  </div>

  <!-- Firebase (modular) -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAMmOyBqyPr5KoIzqnItE4sH1lb83iQAo8",
      authDomain: "lumivue-c8fdf.firebaseapp.com",
      projectId: "lumivue-c8fdf",
      storageBucket: "lumivue-c8fdf.firebasestorage.app",
      messagingSenderId: "120420036736",
      appId: "1:120420036736:web:0fbbc98b02ea54840d3665"
    };

    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById("taxForm");
    const loadingOverlay = document.getElementById("loadingOverlay");
    const saveStatus = document.getElementById("saveStatus");
    const saveButton = document.getElementById("saveButton");

    let currentUser = null;

    function setStatus(text, tone = "") {
      if (!saveStatus) return;
      saveStatus.textContent = text || "";
      saveStatus.className = "status-pill";
      if (tone === "error") {
        saveStatus.classList.add("error");
      } else if (tone === "ok") {
        saveStatus.classList.add("ok");
      }
    }

    function showLoading(show) {
      if (!loadingOverlay) return;
      loadingOverlay.classList.toggle("hidden", !show);
    }

    async function loadExisting() {
      if (!currentUser) return;
      try {
        showLoading(true);
        setStatus("Loading…");
        const ref = doc(db, "creators", currentUser.uid);
        const snap = await getDoc(ref);
        if (snap.exists()) {
          const data = snap.data() || {};
          if (form.taxType) form.taxType.value = data.taxType || "";
          if (form.tin) form.tin.value = data.tin || "";
          if (form.country) form.country.value = data.taxCountry || "";
          if (form.formType) form.formType.value = data.formType || "";
          if (form.agreement) form.agreement.value = data.agreementNotes || "";
          if (form.taxConfirm && typeof data.taxConfirmed === "boolean") {
            form.taxConfirm.checked = data.taxConfirmed;
          }
        }
        setStatus("Loaded", "ok");
      } catch (err) {
        console.error("Error loading tax info", err);
        setStatus("Load error", "error");
      } finally {
        showLoading(false);
      }
    }

    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (!user) {
        setStatus("Not signed in", "error");
        return;
      }
      setStatus("Connected", "ok");
      await loadExisting();
    });

    if (form) {
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!currentUser) {
          setStatus("Please sign in to save", "error");
          return;
        }

        const taxType = form.taxType.value.trim();
        const tin = form.tin.value.trim();
        const country = form.country.value.trim();
        const formType = form.formType.value.trim();
        const agreementNotes = form.agreement.value.trim();
        const taxConfirmed = form.taxConfirm.checked;

        if (!taxType || !tin || !country || !formType || !taxConfirmed) {
          setStatus("All fields + agreement required", "error");
          return;
        }

        saveButton.disabled = true;
        setStatus("Saving…");

        try {
          const ref = doc(db, "creators", currentUser.uid);
          await setDoc(
            ref,
            {
              taxType,
              tin,
              taxCountry: country,
              formType,
              agreementNotes: agreementNotes || null,
              taxConfirmed: true,
              updatedAt: serverTimestamp(),
              sections: { tax: { completed: true } }
            },
            { merge: true }
          );
          setStatus("Saved", "ok");
        } catch (err) {
          console.error("Error saving tax info", err);
          setStatus("Save error", "error");
          alert("Could not save tax details: " + (err.message || err));
        } finally {
          saveButton.disabled = false;
        }
      });
    }
  </script>
</body>
</html>
